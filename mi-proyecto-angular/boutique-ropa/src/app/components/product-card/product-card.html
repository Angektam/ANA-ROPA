<div class="product-card" *ngIf="product">
  <!-- Product Image Container -->
  <div class="product-image-container">
    <div class="product-image">
      <img [src]="product.image" [alt]="product.name" [attr.loading]="priority ? 'eager' : 'lazy'" [attr.fetchpriority]="priority ? 'high' : null">
      <div class="image-overlay"></div>
    </div>
    
    <!-- Product Badges -->
    <div class="product-badges">
      <span class="badge badge-new" *ngIf="product.isNew">
        <i class="fas fa-sparkles"></i>
        Nuevo
      </span>
      <span class="badge badge-sale" *ngIf="product.isOnSale">
        <i class="fas fa-tag"></i>
        -{{ getDiscountPercentage() }}%
      </span>
      <span class="badge badge-hot" *ngIf="product.rating >= 4.5">
        <i class="fas fa-fire"></i>
        Popular
      </span>
    </div>
    
    <!-- Quick Actions Overlay -->
    <div class="product-overlay">
      <div class="overlay-actions">
        <button class="action-btn wishlist-btn" (click)="toggleWishlist()" [class.active]="isInWishlist()">
          <i class="fas fa-heart"></i>
        </button>
        <button class="action-btn quick-view-btn" (click)="onQuickView()">
          <i class="fas fa-eye"></i>
        </button>
        <button class="action-btn compare-btn" (click)="onCompare()">
          <i class="fas fa-balance-scale"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Product Information -->
  <div class="product-info">
    <!-- Category -->
    <div class="product-category">
      <i class="fas fa-tag"></i>
      {{ product.category?.name || 'Sin categoría' }}
    </div>
    
    <!-- Product Name -->
    <h3 class="product-name">
      <a href="#" (click)="onProductClick($event)">{{ product.name }}</a>
    </h3>
    
    <!-- Product Description -->
    <p class="product-description">{{ product.description }}</p>
    
    <!-- Rating -->
    <div class="product-rating">
      <div class="stars">
        <i class="fas fa-star" *ngFor="let star of [1,2,3,4,5]; let i = index" 
           [class.filled]="i < Math.floor(product.rating)"
           [class.half]="i === Math.floor(product.rating) && product.rating % 1 !== 0"></i>
      </div>
      <span class="rating-text">{{ product.rating | number:'1.1-1' }} ({{ product.reviews }} reseñas)</span>
    </div>
    
    <!-- Product Options -->
    <div class="product-options">
      <!-- Size Selector -->
      <div class="option-group size-selector" *ngIf="product.size.length > 1">
        <label class="option-label">
          <i class="fas fa-ruler"></i>
          Talla
        </label>
        <div class="size-options">
          <button *ngFor="let size of product.size" 
                  [class]="'size-btn'"
                  [class.selected]="selectedSize === size.name"
                  [class.unavailable]="!size.available"
                  (click)="onSizeChange(size.name)"
                  [disabled]="!size.available"
                  [title]="size.available ? size.name : 'No disponible'">
            {{ size.name }}
          </button>
        </div>
      </div>
      
      <!-- Color Selector -->
      <div class="option-group color-selector" *ngIf="product.color.length > 1">
        <label class="option-label">
          <i class="fas fa-palette"></i>
          Color
        </label>
        <div class="color-options">
          <button *ngFor="let color of product.color" 
                  [class]="'color-btn ' + color.toLowerCase().replace(' ', '-')"
                  [class.selected]="selectedColor === color"
                  (click)="onColorChange(color)"
                  [title]="color">
            <span class="color-name">{{ color }}</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Price -->
    <div class="product-price">
      <div class="price-container">
        <span class="current-price">${{ product.price | number:'1.2-2' }}</span>
        <span class="original-price" *ngIf="product.originalPrice">
          ${{ product.originalPrice | number:'1.2-2' }}
        </span>
        <span class="savings" *ngIf="product.originalPrice">
          Ahorras ${{ (product.originalPrice - product.price) | number:'1.2-2' }}
        </span>
      </div>
    </div>
    
    <!-- Stock Status -->
    <div class="stock-status">
      <div class="stock-indicator" *ngIf="product.stock > 0">
        <i class="fas fa-check-circle"></i>
        <span *ngIf="product.stock > 10">En stock</span>
        <span *ngIf="product.stock <= 10 && product.stock > 5">Solo {{ product.stock }} disponibles</span>
        <span *ngIf="product.stock <= 5" class="low-stock">¡Solo quedan {{ product.stock }}!</span>
      </div>
      <div class="out-of-stock" *ngIf="product.stock === 0">
        <i class="fas fa-times-circle"></i>
        <span>Agotado</span>
      </div>
    </div>
    
    <!-- Actions -->
    <div class="product-actions">
      <!-- Quantity Selector -->
      <div class="quantity-selector">
        <button class="qty-btn minus" (click)="quantity = Math.max(1, quantity - 1)">
          <i class="fas fa-minus"></i>
        </button>
        <span class="quantity">{{ quantity }}</span>
        <button class="qty-btn plus" (click)="quantity = Math.min(product.stock, quantity + 1)">
          <i class="fas fa-plus"></i>
        </button>
      </div>
      
      <!-- Add to Cart Button -->
      <button class="btn-add-cart" 
              (click)="onAddToCart()" 
              [disabled]="!selectedSize || !selectedColor || product.stock === 0"
              [class.in-cart]="isInCart()"
              [class.loading]="isAddingToCart">
        <i class="fas fa-shopping-cart" *ngIf="!isInCart()"></i>
        <i class="fas fa-check" *ngIf="isInCart()"></i>
        <span class="btn-text">
          {{ isInCart() ? 'En Carrito' : 'Agregar al Carrito' }}
        </span>
        <div class="loading-spinner" *ngIf="isAddingToCart">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      </button>
    </div>
    
    <!-- Additional Info -->
    <div class="product-meta">
      <div class="meta-item" *ngIf="product.brand">
        <i class="fas fa-crown"></i>
        <span>{{ product.brand }}</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-shipping-fast"></i>
        <span>Envío gratis</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-undo"></i>
        <span>Devolución fácil</span>
      </div>
    </div>
  </div>

  <!-- Quick View Modal -->
  <app-quick-view-modal
    [product]="product"
    [isOpen]="showQuickView"
    (close)="closeQuickView()"
  ></app-quick-view-modal>
</div>
